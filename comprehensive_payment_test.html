<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive SumUp Payment Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- SumUp Widget SDK -->
    <script src="https://gateway.sumup.com/gateway/ecom/card/v2/sdk.js"></script>

    <style>
        #sumup-card {
            min-height: 400px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin: 20px 0;
        }
        .test-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85em;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Comprehensive SumUp Payment Test</h1>

        <!-- Test Results -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>SDK Loading Test Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="sdk-status" class="mb-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            Testing SDK availability...
                        </div>
                        <div class="test-log" id="test-log"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Payment Options</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Test Checkout ID:</strong><br>
                        <small>23fbd439-ad7c-4f92-9ca1-b647a6377545</small></p>
                        <p><strong>Amount:</strong> Â£25.00</p>

                        <div class="d-grid gap-2">
                            <button id="test-widget" class="btn btn-primary" disabled>
                                Test Widget Integration
                            </button>
                            <a href="https://api.sumup.com/checkouts/23fbd439-ad7c-4f92-9ca1-b647a6377545"
                               class="btn btn-success">
                                Direct Checkout Redirect
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget Container -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Widget Test Area</h5>
                    </div>
                    <div class="card-body">
                        <div id="widget-status" class="alert alert-info">
                            Widget will be initialized when SDK is ready...
                        </div>
                        <div id="sumup-card"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const checkoutId = '23fbd439-ad7c-4f92-9ca1-b647a6377545';

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('test-log');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';

            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('sdk-status');
            const className = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            statusDiv.innerHTML = `<div class="${className}">${message}</div>`;
        }

        function testSDKAvailability() {
            log('ðŸ” Testing SDK availability...', 'info');

            if (typeof SumUpCard !== 'undefined') {
                log('âœ… SumUpCard object found!', 'success');
                log(`SumUpCard type: ${typeof SumUpCard}`, 'info');
                log(`SumUpCard.mount type: ${typeof SumUpCard.mount}`, 'info');

                updateStatus('âœ… SDK loaded successfully', 'success');

                // Enable widget test button
                const testButton = document.getElementById('test-widget');
                testButton.disabled = false;
                testButton.onclick = initializeWidget;

                return true;
            } else {
                log('âŒ SumUpCard object not found', 'error');
                log(`Available globals: ${Object.keys(window).filter(k => k.includes('Sum')).join(', ')}`, 'info');

                updateStatus('âŒ SDK failed to load', 'error');
                return false;
            }
        }

        function initializeWidget() {
            log('ðŸš€ Initializing SumUp widget...', 'info');

            try {
                const widgetStatus = document.getElementById('widget-status');
                widgetStatus.className = 'alert alert-warning';
                widgetStatus.innerHTML = 'Initializing payment widget...';

                const widget = SumUpCard.mount({
                    id: 'sumup-card',
                    checkoutId: checkoutId,
                    onResponse: function (type, body) {
                        log(`Widget response type: ${type}`, 'info');
                        log(`Widget response body: ${JSON.stringify(body)}`, 'info');

                        widgetStatus.className = 'alert alert-info';
                        widgetStatus.innerHTML = `Payment response: ${type}`;

                        if (type === 'success') {
                            log('ðŸŽ‰ Payment successful!', 'success');
                            widgetStatus.className = 'alert alert-success';
                            widgetStatus.innerHTML = 'âœ… Payment completed successfully!';
                        } else if (type === 'fail' || type === 'error') {
                            log('âŒ Payment failed', 'error');
                            widgetStatus.className = 'alert alert-danger';
                            widgetStatus.innerHTML = `âŒ Payment failed: ${body.message || 'Unknown error'}`;
                        } else if (type === 'cancel') {
                            log('âš ï¸ Payment cancelled', 'info');
                            widgetStatus.className = 'alert alert-warning';
                            widgetStatus.innerHTML = 'âš ï¸ Payment was cancelled';
                        }
                    },
                    onLoad: function() {
                        log('ðŸŽ¯ Widget loaded successfully!', 'success');
                        widgetStatus.className = 'alert alert-success';
                        widgetStatus.innerHTML = 'âœ… Payment form loaded - enter card details to test';
                    }
                });

                log('âœ… SumUpCard.mount() called successfully', 'success');
                log(`Widget object: ${typeof widget}`, 'info');

            } catch (error) {
                log(`âŒ Error initializing widget: ${error.message}`, 'error');

                const widgetStatus = document.getElementById('widget-status');
                widgetStatus.className = 'alert alert-danger';
                widgetStatus.innerHTML = `âŒ Widget initialization failed: ${error.message}`;
            }
        }

        // Test immediately
        log('ðŸš€ Starting comprehensive payment test...', 'info');

        // Test SDK availability immediately
        if (!testSDKAvailability()) {
            // If not available immediately, try again after delay
            setTimeout(() => {
                log('ðŸ”„ Retrying SDK test after delay...', 'info');
                testSDKAvailability();
            }, 2000);
        }

        // Global error handler
        window.addEventListener('error', function(event) {
            log(`ðŸ’¥ JavaScript Error: ${event.message}`, 'error');
            log(`Source: ${event.filename}:${event.lineno}`, 'error');
        });
    </script>
</body>
</html>